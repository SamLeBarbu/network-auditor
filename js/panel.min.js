function activateButton(e,t){""!==filterHidden.value.trim()&&(filterHidden.value+=" OR ",activatedButtons.value+="|"),filterHidden.value+=t,activatedButtons.value+=e,updateRequestList(),chrome.storage.sync.set({filterHiddenValue:filterHidden.value}),chrome.storage.sync.set({activatedButtonsValue:activatedButtons.value}),document.getElementById(e).className="normalButtonGreen",document.getElementById("tiny_"+e).style.display="inline"}function deactivateButton(e,t){filterHidden.value=filterHidden.value.replace(t,""),filterHidden.value=filterHidden.value.replace(" OR  OR "," OR "),filterHidden.value.endsWith(" OR ")&&(filterHidden.value=filterHidden.value.slice(0,-4)),filterHidden.value.startsWith(" OR ")&&(filterHidden.value=filterHidden.value.slice(4)),activatedButtons.value=activatedButtons.value.replace(e,""),activatedButtons.value=activatedButtons.value.replace("||","|"),activatedButtons.value.endsWith("|")&&(activatedButtons.value=activatedButtons.value.slice(0,-1)),activatedButtons.value.startsWith("|")&&(activatedButtons.value=activatedButtons.value.slice(1)),updateRequestList(),chrome.storage.sync.set({filterHiddenValue:filterHidden.value}),chrome.storage.sync.set({activatedButtonsValue:activatedButtons.value}),document.getElementById(e).className="normalButton",document.getElementById("tiny_"+e).style.display="none"}function applyNetworkFilters(e){chrome.devtools.network.onRequestFinished.addListener(t=>{const n=t.request.url;let o=e.some(e=>n.includes(e));o&&addRequestToTable(t)})}function updateRequestList(){const e=filterInput.value.toLowerCase(),t=filterHidden.value.toLowerCase();let n;n=""!==e.trim()&&""!==t.trim()?e+" OR "+t:""!==e.trim()&&""===t.trim()?e:""===e.trim()&&""!==t.trim()?t:"",requestList.innerHTML="",pageUrls.forEach(e=>{addPageUrlRow(e.url);networkRequests.filter(e=>{const t=e.request.url.toLowerCase(),o=parseQuery(n);""!==n?evaluate(o,t)&&addRequestToTable(e):addRequestToTable(e)})})}function addRequestToTable(e){let t;e.request.url.includes("?")?(t=e.request.url.split("?")[0].split("/").slice(-1),t+="?"+e.request.url.split("?")[1]):t=e.request.url.split("/").slice(-1),e.request.url.includes("gtm.js")?toolFavicon="gtm":e.request.url.includes("cdn.tagcommander.com")||e.request.url.includes("cdn.trustcommander.net")||e.request.url.includes("privacy_v")&&e.request.url.includes(".js")||e.request.url.includes("tc_")&&e.request.url.includes(".js")?toolFavicon="commandersact":e.request.url.includes("xiti.com/event")?toolFavicon="piano":e.request.url.includes("xiti.com/hit.xiti")?toolFavicon="atinternet":e.request.url.includes("ppms.js")||e.request.url.includes("ppms.php")?toolFavicon="piwik":e.request.url.includes("matomo.js")||e.request.url.includes("matomo.php")?toolFavicon="matomo":e.request.url.includes("contentsquare.net/uxa")||e.request.url.includes("contentsquare.net/v2")||e.request.url.includes("contentsquare.net/pageview")?toolFavicon="contentsquare":e.request.url.includes("n.clarity.ms/collect")?toolFavicon="clarity":e.request.url.includes("data.kameleoon.eu")?toolFavicon="kameleoon":e.request.url.includes("try.abtasty.com")||e.request.url.includes("ariane.abtasty.com")?toolFavicon="abtasty":e.request.url.includes("bat.bing.com/action")||e.request.url.includes("bat.bing.com/p/action")||e.request.url.includes("bat.bing.net/actionp")?toolFavicon="bing":e.request.url.includes("/g/collect")||e.request.url.includes("googletagmanager.com/gtag/js?id=G-")?toolFavicon="ga4":e.request.url.includes("google.com/ccm/collect")?toolFavicon="google":(e.request.url.includes("doubleclick.net")||e.request.url.includes("googletagmanager.com/gtag/js?id=AW-")||e.request.url.includes("googletagmanager.com/gtag/js?id=DC-"))&&(toolFavicon="googleads");const n=e.response.content.mimeType.split("/")[1],o=document.createElement("tr");"gtm"==toolFavicon||"commandersact"==toolFavicon||"piano"==toolFavicon||"atinternet"==toolFavicon||"piwik"==toolFavicon||"matomo"==toolFavicon||"contentsquare"==toolFavicon||"clarity"==toolFavicon||"kameleoon"==toolFavicon||"abtasty"==toolFavicon||"bing"==toolFavicon||"ga4"==toolFavicon||"google"==toolFavicon||"googleads"==toolFavicon?(toolFavicon=`<img src="../favicons/favicon_${toolFavicon}.png" alt="favicon" class="favicon">`,e.request.url.includes(".js")||e.request.url.includes("/js")?toolFavicon+=' <img src="../favicons/js_green.png" alt="js" class="favicon"> ':toolFavicon+=' <img src="../favicons/send_pink.png" alt="js" class="favicon"> '):toolFavicon="",o.className="request-item",o.innerHTML=`\n        <td title="${e.request.url}">${toolFavicon}/${t}</td>\n        <td>${e.response.status}</td>\n        <td>${e.request.method}</td>\n        <td>${n}</td>\n    `,o.addEventListener("click",()=>{isPreview=!(!(e.request.url.includes("cdn.tagcommander.com")||e.request.url.endsWith(".js")||e.request.url.includes(".json"))||e.request.url.includes("xiti.com")),showRequestDetails(e)}),requestList.appendChild(o)}function addPageUrlRow(e){const t=e.split("?")[0],n=document.createElement("tr");n.className="page-url-item",n.innerHTML=`\n        <td colspan="4" class="page-url">${t}</td>\n    `,requestList.appendChild(n)}function showRequestDetails(e){e.getContent(t=>{let n,o=e.request.url;if(o.includes("%")&&(o=decodeURIComponent(o)),!0===isPreview)e.request.url.includes(".json")&&(t=JSON.stringify(JSON.parse(t),null,2)),n=`\n        <span class="green">URL:</span><br><a href="${e.request.url}" target="_blank" class="code"><pre>${o}</pre></a><br><br>\n        <span class="green">Preview:</span><br><pre>${t}</pre><br><br>\n      `;else{let t=e.request.queryString.map(e=>`${e.name}: ${e.value}`).join("\n"),s=e.request.postData?JSON.stringify(JSON.parse(e.request.postData.text),null,2):"N/A";t.includes("%")&&(t=decodeURIComponent(t)),s.includes("%")&&(s=decodeURIComponent(s)),n=`\n        <span class="green">URL:</span><br><a href="${e.request.url}" target="_blank" class="code"><pre>${o}</pre></a><br><br>\n        <span class="green">Query Parameters:</span><br><pre>${t}</pre><br><br>\n        <span class="green">Request Payload:</span><br><pre>${s}</pre>\n        `}requestDetails.innerHTML=n,overlay.style.display="block"})}function tokenize(e){e=e.replace(/\(/g," ( ").replace(/\)/g," ) ").toLowerCase();const t=e.trim().split(/\s+/);return t.filter(Boolean)}function parseQuery(e){const t=new TokenStream(tokenize(e)),n=parseOrExpr(t);if(t.hasMore())throw new Error("Unexpected extra tokens after parsing.");return n}function parseOrExpr(e){let t=parseAndExpr(e);for(;"or"===e.peek();){e.next();const n=parseAndExpr(e);t={type:"binary",op:"OR",left:t,right:n}}return t}function parseAndExpr(e){let t=parseFactor(e);for(;"and"===e.peek();){e.next();const n=parseFactor(e);t={type:"binary",op:"AND",left:t,right:n}}return t}function parseFactor(e){if("not"===e.peek()){e.next();const t=parseFactor(e);return{type:"unary",op:"NOT",node:t}}if("("===e.peek()){e.next();const t=parseOrExpr(e);if(")"!==e.peek())throw new Error("Missing closing parenthesis.");return e.next(),t}const t=e.next();return{type:"literal",value:t}}function evaluate(e,t){switch(e.type){case"literal":return t.includes(e.value);case"unary":return!evaluate(e.node,t);case"binary":const n=evaluate(e.left,t),o=evaluate(e.right,t);if("AND"===e.op)return n&&o;if("OR"===e.op)return n||o;throw new Error("Unknown binary operator: "+e.op);default:throw new Error("Unknown AST node type: "+e.type)}}function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTop.style.display="block":backToTop.style.display="none"}const filterInput=document.getElementById("filterInput"),filterHidden=document.getElementById("filterHidden"),activatedButtons=document.getElementById("activatedButtons"),requestList=document.getElementById("requestList"),showFilters=document.getElementById("showFilters"),clearFilters=document.getElementById("clearFilters"),clearRequestsButton=document.getElementById("clearRequests"),overlay=document.getElementById("overlay"),closeOverlayButton=document.getElementById("closeOverlay"),requestDetails=document.getElementById("requestDetails"),trustCoButton=document.getElementById("trustCoButton"),oneTrustButton=document.getElementById("oneTrustButton"),cookieBotButton=document.getElementById("cookieBotButton"),didomiButton=document.getElementById("didomiButton"),tarteAuCitronButton=document.getElementById("tarteAuCitronButton"),gtmClientSideButton=document.getElementById("gtmClientSideButton"),gtmServerSideButton=document.getElementById("gtmServerSideButton"),tagCoButton=document.getElementById("tagCoButton"),ga4ClientSideButton=document.getElementById("ga4ClientSideButton"),ga4ServerSideButton=document.getElementById("ga4ServerSideButton"),googleAdsButton=document.getElementById("googleAdsButton"),googleTagButton=document.getElementById("googleTagButton"),pianoButton=document.getElementById("pianoButton"),atinternetButton=document.getElementById("atinternetButton"),piwikButton=document.getElementById("piwikButton"),csButton=document.getElementById("csButton"),clarityButton=document.getElementById("clarityButton"),kameleoonButton=document.getElementById("kameleoonButton"),abtastyButton=document.getElementById("abtastyButton"),bingButton=document.getElementById("bingButton"),popinNews=document.getElementById("popinNews"),closePopinNews=document.getElementById("closePopinNews"),menuNews=document.getElementById("menuNews"),popinBugs=document.getElementById("popinBugs"),closePopinBugs=document.getElementById("closePopinBugs"),menuBugs=document.getElementById("menuBugs"),menuHelp=document.getElementById("menuHelp"),closePopinHelp=document.getElementById("closePopinHelp"),popinHelp=document.getElementById("popinHelp"),backToTop=document.getElementById("backToTop");let toolFavicon,requestType,networkRequests=[],pageUrls=[],isPreview=!1;chrome.devtools.network.onRequestFinished.addListener(e=>{networkRequests.push(e),updateRequestList()}),chrome.devtools.network.onNavigated.addListener(e=>{pageUrls.push({url:e,requests:[]}),updateRequestList()}),filterInput.addEventListener("input",updateRequestList),filterHidden.addEventListener("input",updateRequestList),showFilters.addEventListener("click",()=>{"show"===document.getElementById("divFilters").attributes["data-status"].value?(document.getElementById("divFilters").className="divFiltersOut",showFilters.style.backgroundColor="#36eba9",showFilters.style.color="#280137",showFilters.innerText="Show predefined filters",document.getElementById("divFilters").attributes["data-status"].value="hidden",_paq.push(["trackEvent","Actions","Hide filters"]),setTimeout(()=>{document.getElementById("divFilters").style.display="none"},400)):(document.getElementById("divFilters").className="divFiltersIn",document.getElementById("divFilters").style.display="block",showFilters.style.backgroundColor="#eb3678",showFilters.style.color="white",showFilters.innerText="Hide predefined filters",overlay.style.display="none",document.getElementById("divFilters").attributes["data-status"].value="show",_paq.push(["trackEvent","Actions","Show filters"]))}),clearFilters.addEventListener("click",()=>{chrome.storage.sync.get("activatedButtonsValue",({activatedButtonsValue:e})=>{const t=e.split("|");t.forEach(e=>{document.getElementById(e).className="normalButton",document.getElementById("tiny_"+e).style.display="none"})});document.getElementById("filterInput").value="",document.getElementById("filterHidden").value="",document.getElementById("activatedButtons").value="",chrome.storage.sync.set({filterInputValue:""}),chrome.storage.sync.set({filterHiddenValue:""}),chrome.storage.sync.set({activatedButtonsValue:""}),updateRequestList(),_paq.push(["trackEvent","Actions","Clear filters"])}),clearRequestsButton.addEventListener("click",()=>{networkRequests=[],pageUrls=[],updateRequestList(),_paq.push(["trackEvent","Actions","Clear requests"])}),closeOverlayButton.addEventListener("click",()=>{overlay.style.display="none"});const buttons=Array.from(document.getElementsByClassName("normalButton")).map(e=>e.id);buttons.forEach(e=>{const t=document.getElementById(e);t.addEventListener("click",()=>{"normalButton"===t.className?(activateButton(e,t.attributes["data-syntax"].value),_paq.push(["trackEvent","Filters",e,"ON"])):(deactivateButton(e,t.attributes["data-syntax"].value),_paq.push(["trackEvent","Filters",e,"OFF"]))})}),chrome.storage.sync.get("filterInputValue",({filterInputValue:e})=>{e&&(filterInput.value=e,updateRequestList())}),chrome.storage.sync.get("filterHiddenValue",({filterHiddenValue:e})=>{e&&(filterHidden.value=e,updateRequestList())}),chrome.storage.sync.get("activatedButtonsValue",({activatedButtonsValue:e})=>{if(e){activatedButtons.value=e;const t=e.split("|");t.forEach(e=>{document.getElementById(e).className="normalButtonGreen",document.getElementById("tiny_"+e).style.display="inline"})}}),filterInput.addEventListener("input",()=>{chrome.storage.sync.set({filterInputValue:filterInput.value})}),filterHidden.addEventListener("input",()=>{chrome.storage.sync.set({filterHiddenValue:filterHidden.value})}),activatedButtons.addEventListener("input",()=>{chrome.storage.sync.set({activatedButtonsValue:activatedButtons.value})});class TokenStream{constructor(e){this.tokens=e,this.index=0}peek(){return this.tokens[this.index]}next(){return this.tokens[this.index++]}hasMore(){return this.index<this.tokens.length}}menuNews.addEventListener("click",()=>{popinNews.style.display="block",_paq.push(["trackEvent","Menu","What's new"])}),menuBugs.addEventListener("click",()=>{popinBugs.style.display="block",_paq.push(["trackEvent","Menu","Bugs"])}),menuHelp.addEventListener("click",()=>{popinHelp.style.display="block",_paq.push(["trackEvent","Menu","Help"])}),closePopinNews.addEventListener("click",()=>{popinNews.style.display="none"}),closePopinBugs.addEventListener("click",()=>{popinBugs.style.display="none"}),closePopinHelp.addEventListener("click",()=>{popinHelp.style.display="none"}),backToTop.addEventListener("click",()=>{window.scrollTo(0,0),_paq.push(["trackEvent","Actions","Back to top"])}),window.onscroll=function(){scrollFunction()};